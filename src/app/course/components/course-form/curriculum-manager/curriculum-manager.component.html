<mat-card class="curriculum-card">
  <mat-card-header>
    <mat-card-title>Course Curriculum</mat-card-title>
    <button mat-raised-button color="accent" (click)="startAddSection()" *ngIf="!editingSection">
      <mat-icon>add</mat-icon>
      Add Section
    </button>
  </mat-card-header>

  <mat-card-content>
    <!-- Loading State -->
    <div *ngIf="isLoadingCurriculum" class="loading-curriculum">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Loading curriculum...</p>
    </div>

    <!-- Add/Edit Section Form -->
    <app-section-form
      *ngIf="editingSection"
      [section]="editingSection"
      [sectionsCount]="sections.length"
      (save)="saveSection($event)"
      (cancel)="cancelEditSection()">
    </app-section-form>

    <!-- Empty State -->
    <div *ngIf="!isLoadingCurriculum && sections.length === 0 && !editingSection" class="empty-state">
      <mat-icon>playlist_add</mat-icon>
      <p>No curriculum added yet. Click "Add Section" to get started.</p>
    </div>

    <!-- Sections List -->
    <mat-accordion *ngIf="sections.length > 0" multi>
      <mat-expansion-panel *ngFor="let section of sections; let i = index" class="section-panel">
        <mat-expansion-panel-header>
          <mat-panel-title>
            <mat-icon class="section-icon">folder</mat-icon>
            <span class="section-title">{{ section.order }}. {{ section.title }}</span>
            <span class="lesson-count">({{ section.lessons.length || 0 }} lessons)</span>
          </mat-panel-title>
          <mat-panel-description>
            {{ section.description }}
          </mat-panel-description>
        </mat-expansion-panel-header>

        <!-- Section Content -->
        <div class="section-content">
          <!-- Section Actions -->
          <div class="section-actions">
            <button mat-icon-button (click)="startEditSection(section)" matTooltip="Edit section">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button (click)="moveSectionUp(section)" [disabled]="i === 0" matTooltip="Move up">
              <mat-icon>arrow_upward</mat-icon>
            </button>
            <button mat-icon-button (click)="moveSectionDown(section)" [disabled]="i === sections.length - 1" matTooltip="Move down">
              <mat-icon>arrow_downward</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="deleteSection(section)" matTooltip="Delete section">
              <mat-icon>delete</mat-icon>
            </button>
          </div>

          <!-- Add/Edit Lesson Form -->
          <app-lesson-form
            *ngIf="editingLesson?.section?.id === section.id"
            [lesson]="editingLesson?.lesson || null"
            [section]="section"
            (save)="saveLesson($event)"
            (cancel)="cancelEditLesson()">
          </app-lesson-form>

          <!-- Lessons List -->
          <div class="lessons-list">
            <div *ngIf="!section.lessons || section.lessons.length === 0" class="empty-lessons">
              <p>No lessons in this section yet.</p>
            </div>

            <div *ngFor="let lesson of section.lessons; let j = index" class="lesson-item">
              <div class="lesson-info">
                <mat-icon class="lesson-icon">{{ getLessonTypeIcon(lesson.type) }}</mat-icon>
                <div class="lesson-details">
                  <div class="lesson-title">{{ lesson.order }}. {{ lesson.title }}</div>
                  <div class="lesson-meta">
                    <span class="lesson-type">{{ lesson.type | titlecase }}</span>
                    <span *ngIf="lesson.duration" class="lesson-duration">{{ lesson.duration }} min</span>
                  </div>
                </div>
              </div>

              <div class="lesson-actions">
                <button mat-icon-button (click)="startEditLesson(section, lesson)" matTooltip="Edit lesson">
                  <mat-icon>edit</mat-icon>
                </button>
                <button mat-icon-button (click)="moveLessonUp(section, lesson)" [disabled]="j === 0" matTooltip="Move up">
                  <mat-icon>arrow_upward</mat-icon>
                </button>
                <button mat-icon-button (click)="moveLessonDown(section, lesson)"
                        [disabled]="j === section.lessons.length - 1" matTooltip="Move down">
                  <mat-icon>arrow_downward</mat-icon>
                </button>
                <button mat-icon-button color="warn" (click)="deleteLesson(section, lesson)" matTooltip="Delete lesson">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>
          </div>

          <!-- Add Lesson Button -->
          <button mat-stroked-button color="primary" (click)="startAddLesson(section)"
                  *ngIf="!editingLesson" class="add-lesson-btn">
            <mat-icon>add</mat-icon>
            Add Lesson
          </button>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
  </mat-card-content>
</mat-card>
